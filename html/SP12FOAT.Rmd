---
title: "SP12FOAT"
output: 
  flexdashboard::flex_dashboard:
    theme: bootstrap
    source_code: embed
    orientation: rows
---

```{r setup, include = FALSE}
library(flexdashboard)
library(maptools)
library(tidyverse)
library(purrr)
library(leaflet)
library(plotly)
library(lipdR)
library(dygraphs)
library(geoChronR)

#read functions
source("../functions.R")

#prepare LiPD data..
# D <- readLipd("~/Dropbox/LiPD/PAGES2k/Temp_v2_1_0/")
# TS <- extractTs(D)
load("../temp.Rdata")

#remove columns we don't want to plot
varNames <- sapply(TS, "[[","paleoData_variableName")

good <- which(!(varNames %in% c("year","depth","age")))
TS <- TS[good]


#All datasets
dsn <- sapply(TS,"[[","dataSetName")
ui <- which(!duplicated(dsn))
udsn <- dsn[ui]
lat <- as.numeric(sapply(TS,"[[","geo_latitude")[ui])
lon <- as.numeric(sapply(TS,"[[","geo_longitude")[ui])
#elev <- sapply(TS,"[[","geo_elevation")[ui]
archiveType <- sapply(TS,"[[","archiveType")[ui]
link <- paste0(udsn,".html") %>% 
  str_replace_all("'","_")

#Organize metadata for map
map.meta <- data.frame(dataSetName = udsn, #datasetname
                       lat = lat,#lat
                       lon = lon,#lon
                      # elev = elev,#elevation
                       archiveType = factor(archiveType),#archiveType
                       link = link)#Link

#set index number

i = 445
thisTS <- TS[which(udsn[i] == dsn)]
```
#SP12FOAT

Metadata {.sidebar}
-------------------------------------
[Download LiPD file](SP12FOAT.lpd)
            

[Report an issue (include dataset name)](https://github.com/nickmckay/LiPDverse/issues)

<details open style="margin-left: 0px">
<summary>root</summary>
<p style="margin-left: 0px"><strong>archiveType: </strong>speleothem
<p style="margin-left: 0px"><strong>lipdVersion: </strong>1.3
</details>
<details>
<summary>pub</summary>
<details style="margin-left: 10px">
<summary>pub1</summary>
<p style="margin-left: 10px"><strong>author: </strong>Fohlmeister
<p style="margin-left: 10px"><strong>pubYear: </strong>2012
<p style="margin-left: 10px"><strong>DOI: </strong>10.1177/0959683612465446
</details>
</details>
<details open style="margin-left: 0px">
<summary>geo</summary>
<p style="margin-left: 0px"><strong>latitude: </strong>47.09
<p style="margin-left: 0px"><strong>longitude: </strong>11.67
<p style="margin-left: 0px"><strong>elevation: </strong>NA
<p style="margin-left: 0px"><strong>siteName: </strong>Spannagel Cave, Austria
</details>
<details open>
<summary>PaleoData columns</summary>
<details style="margin-left: 10px">
<summary>d18O</summary>
<p style="margin-left: 10px"><strong>TSid: </strong>SP12FOAT01A
<p style="margin-left: 10px"><strong>variableName: </strong>d18O
<p style="margin-left: 10px"><strong>units: </strong>permil
<p style="margin-left: 10px"><strong>description: </strong>carbonate
<details>
<summary>interpretation</summary>
<details style="margin-left: 20px">
<summary>1</summary>
<p style="margin-left: 20px"><strong>basis: </strong>Spannagel ?18O records and growth phases are in agreement with the ?18O pattern in Greenland ice cores on millennial to orbital timescales (Sp�tl and  Mangini, 2007 Sp�tl et al., 2006), with sediment proxies and growth of deep-sea corals from the North Atlantic (Frank et al., 2009; Mangini et al., 2005) and with other stalagmites from central Europe (Mangini et al., 2007). Trouet et al. (2009) found and discussed similarities of Spannagel speleothem ?18O values in  relation to their NAO reconstruction for the past 1000 yr based on speleothem data from Scotland (Proctor et al., 2000) and tree-ring data from Morocco (Esper et al., 2007). In addition, the super-regional character of our alpine location was explicitly demonstrated in a proxy intercomparison study investigating teleconnections between the tropical Pacific and mid-latitude regions (Graham et al., 2007).
<p style="margin-left: 20px"><strong>interpDirection: </strong>decrease
<p style="margin-left: 20px"><strong>scope: </strong>climate
<p style="margin-left: 20px"><strong>variable: </strong>Temperature
<p style="margin-left: 20px"><strong>variableDetail: </strong>variations in air temperature due to large-scale atmospheric patterns
</details>
<details style="margin-left: 20px">
<summary>2</summary>
<p style="margin-left: 20px"><strong>basis: </strong>The observed strong decrease in the ?18O by about 1.5? between 11 and 10 ka, for example, is rather a change of the source region than a pure temperature  effect. Based on this assumption, during the deglaciation the trajectories more frequently followed southerly routes. Towards the transition into the Holocene the main contribution of precipitation probably originated from more northern regions of the Atlantic, where the surface ocean is generally more depleted in 18O (LeGrande and Schmidt, 2006).
<p style="margin-left: 20px"><strong>equilibriumEvidence: </strong>Owing to the low cave temperature kinetic isotope effects are minimal (Mangini et al., 2005; Vollweiler et al., 2006).
<p style="margin-left: 20px"><strong>inferredMaterial: </strong>groundwater d18O
<p style="margin-left: 20px"><strong>integrationTime: </strong>Average resolution of each stal 5.1 yr (SPA12), 3.5 yr (SPA128), 8 yr (SPA70), 4 yr (SPA127) and 1.6 yr (SPA133).
<p style="margin-left: 20px"><strong>integrationTimeBasis: </strong>iscam method (Fohlmeister et al., 2012), based on simulations and correlation calculations between pairs of climate  records (this is a stack of 5 records). Point-wise linear interpolation between data points. Typical age errors are smaller than 2%.
<p style="margin-left: 20px"><strong>integrationTimeUnits: </strong>year
<p style="margin-left: 20px"><strong>mathematicalRelation: </strong>nonlinear.
<p style="margin-left: 20px"><strong>rank: </strong>2
<p style="margin-left: 20px"><strong>scope: </strong>isotope
<p style="margin-left: 20px"><strong>variable: </strong>temperature ( higher ?18O values characterize a colder climate and viceversa)
</details>
</details>
</details>

Row
-----------------------------------------------------------------------

### Sitemap

```{r}
  map.meta.split <- split(map.meta, map.meta$archiveType)


factpal <- colorFactor("Paired",map.meta$archiveType)
buff <- 15
l <- leaflet() %>% 
  addTiles() %>% 
  fitBounds(map.meta$lon[i]-buff,map.meta$lat[i]-buff,map.meta$lon[i]+buff,map.meta$lat[i]+buff)
  

  
  
names(map.meta.split) %>%
  purrr::walk( function(df) {
    l <<- l %>%
      addMarkers(data=map.meta.split[[df]],
                 lng=~lon, lat=~lat,
                 label=~as.character(archiveType),
                 popup=~paste(str_c('Dataset: <a href="',link,'">',dataSetName,'</a>'),
                                 # str_c("Elevation: ",elev),
                                  str_c("Archive Type: ",archiveType),
                                  sep = "<br>"),
                 group = df,
                 clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = F),
                 labelOptions = labelOptions(noHide = F,
                                             direction = 'auto'))
  })

l %>%
  addLayersControl(position = "bottomleft",
    overlayGroups = names(map.meta.split),
    options = layersControlOptions(collapsed = FALSE,
                                   opacity = 0.8)
  )
```

Row {.tabset .tabset-fade}
-----------------------------------------------------------------------

### d18O
```{r}
plotCol(thisTS,ind = 1)
```
